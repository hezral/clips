app-id: com.github.hezral.clips
runtime: io.elementary.Platform
runtime-version: '6'
sdk: io.elementary.Sdk
command: com.github.hezral.clips
finish-args:
  - --share=ipc
  - --socket=wayland
  - --socket=fallback-x11

  # network access for clips to retrieve basic info on URLs
  - --share=network

  # read-only access to get installed app and icons based on .desktop files
  - --filesystem=host:ro
  - --filesystem=xdg-data:ro
  - --filesystem=xdg-data/applications:ro
  - --filesystem=xdg-data/icons:ro
  - --filesystem=/var/lib/flatpak/app:ro
  - --filesystem=/var/lib/snapd/desktop:ro
  - --filesystem=/var/lib/flatpak/exports/share/applications:ro
  - --filesystem=/var/lib/flatpak/exports/share/icons:ro

  # keyring access for setting password for clips protection
  - --talk-name=org.freedesktop.secrets

modules:
  - name: chardet
    buildsystem: simple
    build-options:
      build-args:
        - --share=network
    build-commands:
      - "pip3 install --prefix=${FLATPAK_DEST} chardet"

  - name: requests
    buildsystem: simple
    build-options:
      build-args:
        - --share=network
    build-commands:
      - "pip3 install --prefix=${FLATPAK_DEST} requests"

  - name: python-keyring
    buildsystem: simple
    build-options:
      build-args:
        - --share=network
    build-commands:
      - "pip3 install --prefix=${FLATPAK_DEST} keyring"

  - name: python-xlib
    buildsystem: simple
    build-options:
      build-args:
        - --share=network
    build-commands:
      - "pip3 install --prefix=${FLATPAK_DEST} python-xlib"

  - name: pynput
    buildsystem: simple
    build-options:
      build-args:
        - --share=network
    build-commands:
      - "pip3 install --prefix=${FLATPAK_DEST} pynput"

  - name: libx11-dev
    buildsystem: autotools
    sources:
      - type: archive
        url: http://archive.ubuntu.com/ubuntu/pool/main/libx/libx11/libx11_1.6.9.orig.tar.gz
        sha256: b8c0930a9b25de15f3d773288cacd5e2f0a4158e194935615c52aeceafd1107b
  - name: libxmu-headers
    buildsystem: autotools
    sources:
      - type: archive
        url: http://archive.ubuntu.com/ubuntu/pool/main/libx/libxmu/libxmu_1.1.3.orig.tar.gz
        sha256: 5bd9d4ed1ceaac9ea023d86bf1c1632cd3b172dce4a193a72a94e1d9df87a62e
  - name: libxt-dev
    buildsystem: autotools
    sources:
      - type: archive
        url: http://archive.ubuntu.com/ubuntu/pool/main/libx/libxt/libxt_1.1.5.orig.tar.gz
        sha256: b59bee38a9935565fa49dc1bfe84cb30173e2e07e1dcdf801430d4b54eb0caa3
  - name: libxmu-dev
    buildsystem: autotools
    sources:
      - type: archive
        url: http://archive.ubuntu.com/ubuntu/pool/main/libx/libxmu/libxmu_1.1.3.orig.tar.gz
        sha256: 5bd9d4ed1ceaac9ea023d86bf1c1632cd3b172dce4a193a72a94e1d9df87a62e
  - name: xclip
    buildsystem: autotools
    sources:
      - type: git
        url: https://github.com/astrand/xclip.git

  - name: libpwquality
    sources:
      - type: git
        url: https://github.com/libpwquality/libpwquality.git

  - name: clips
    buildsystem: meson
    sources:
      - type: dir
        path: .
